<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Geo Test</title>
    <link rel="stylesheet" href="resources/css/geocongress.css" type="text/css">
    <script type="text/javascript" src="src/sencha-touch-debug-w-comments.js"></script>
</head>
<body>
</body>
</html>
<script type="text/javascript">
    var asWCFDate = function (datetime) { 
    return datetime.format("M$").replace("\\","").replace("\\","");
    }
    var onGeoUpdate = function (coords) {
        // was getting circular ref trying to turn coords into json, so harvest what we want out of coords, jsonify that
        debugger;
        var nonCircularCoord = { Accuracy: coords.accuracy, Altititude: coords.altitude, AltitudeAccuracy: coords.altitudeaccuracy,
            Heading: coords.heading, Latitude: coords.latitude, Longitude: coords.longitude, Speed: coords.speed, 
            Timestamp: asWCFDate(coords.timestamp)
        };        
        alert(nonCircularCoord.Timestamp);
        var jsonCoords = Ext.encode(nonCircularCoord);
        Ext.Ajax.request({
            url: 'http://localhost/Services/Location/Create',
            method: 'POST',
            headers: { 'Content-Type': 'application/json; charset=utf-8' },
            params: jsonCoords,
            success: function (result, request) { alert('success'); },
            failure: function (result, request) { alert('failure'); }
        });
    };
    Ext.setup({
        onReady: function () {            
            geo = new Ext.util.GeoLocation({ autoUpdate: false });
            geo.on('locationupdate', onGeoUpdate, geo.coords);
            geo.updateLocation();
        }
    });
</script>
